# Shigodeki TestFlight ベータ取扱説明書

## このドキュメントについて
- App Store 提出前の TestFlight ビルドで基本フローを体験・検証するための簡易マニュアルです。
- ここに記載の文言は 2025-09 時点の UI／機能構成を基準にしています。ビルド更新で差異が出た場合はメモに残してください。
- ベータ中はログやトーストで内部情報が表示されることがあります。公開版では非表示になる想定です。

## 1. テストの準備
### TestFlight を入手
- 招待メールまたは公開リンクから TestFlight をインストールし、同じ Apple ID でログインします。
- 招待を受けた後に TestFlight アプリ内の「受信済み」タブから Shigodeki をダウンロードしてください。
- インストール後は通知・写真アクセスなどの権限を求められたら許可しておくと検証がスムーズです。

### 初回サインイン
- 推奨: `Sign in with Apple` をタップすると本番と同じ認証フローで参加できます。
- 簡易確認用: `デモとしてサインイン` は匿名アカウントで即時ログインできます。デモ利用時はデータが共有されず、チーム招待テストも行えません。
- エラー表示が出た場合はそのままスクリーンショットを撮り、時刻と操作手順をメモしてください。

### 推奨環境
- iOS / iPadOS 17 以降、ネットワーク接続が安定している状態での利用を想定しています。
- Beta 期間中は Firebase 本番プロジェクトに接続しています。長時間のオフライン利用は未検証です。

## 2. 画面構造とキータブ
- `ホーム`: フラグ `dashboardRefreshEnabled` が無効な場合は従来どおりプロジェクト一覧へのハブ。フラグを有効化すると「ダッシュボード」表示になり、担当タスクとAIドラフト、クイック操作カードが並びます。ダッシュボードから `作業を追加` を選ぶと TaskAddModal が開き、AI／テンプレート／写真導線がひとつのモーダルにまとまります。
- `プロジェクト`: 所属プロジェクトの一覧と詳細。フェーズ追加やタスク管理はここから開始します。`taskAddModalEnabled` が有効なビルドでは、プロジェクト／タスクリスト詳細のツールバーに「ファミリーへ戻る」ボタンが表示され、所属ファミリー画面へすぐ戻れます。
- `チーム`: 「ファミリー」単位のチーム管理。招待コードの発行や加入を行います。
- `設定`: アカウント名変更、AI 設定、テーマ切替、サインアウトをまとめています。
- **クイック追加**: フラグ有効時はホーム/プロジェクト画面右下の `＋` ボタン、またはダッシュボード内の「クイック操作」カードから、タスク追加モーダル／AIアシスタント／テンプレート／チーム招待へジャンプできます。
- 開発用 `テスト` タブは TestFlight ビルドでは非表示です。

## 3. チーム（Family）ワークフロー
### チームを作成する
- `チーム` タブ右上の `チームを作成` を押して名称と説明（任意）を入力します。
- 作成後は一覧に新しいチームが追加され、メンバー数 1（自分）で開始します。

### 招待コードを共有する
- チームを選択すると詳細画面が開きます。`アクション > メンバーを招待` をタップすると招待コードが生成されます。
- 表示される 6 桁コードをタップするとコピー、`招待コードを共有` から各種アプリで送信できます。
- コードは 30 日間有効です。別日でも同じコードを再利用できます。

### 既存チームに参加する
- `チーム` タブの `チームに加入` で招待コード（`INV-XXXXXX` または数字 6 桁）を入力します。ハイフン・大小文字は自動補正されます。
- 加入が完了するとチーム一覧に自動で追加され、詳細ビューが選択状態になります。
- 「コードが無効」と表示された場合は、入力した文字と受け取ったコードを比較し、似た文字（O/0, I/1, L/1）を再確認してください。

## 4. プロジェクトを管理する
### 新規プロジェクトを作成する
- `プロジェクト` タブで `プロジェクトを作成` を選び、名称・説明・オーナー（個人 or チーム）を設定します。
- 必要に応じてテンプレートを選択すると初期フェーズ／タスクが自動で下書きされます。AI 生成によるプロジェクト作成はベータでは非表示です。

### プロジェクト詳細での主な操作
- 一覧からプロジェクトを選ぶと詳細画面が表示されます。
  - `＋` ボタン: 新しいフェーズを追加します。TaskAddModal 機能が有効になっている場合、タスク作成は各詳細画面の `追加` ボタン（モーダル経由）に集約されます。
  - `ギア` ボタン: プロジェクト設定（名称変更、完了フラグ、招待コード発行など）。
  - `脳` ボタン: プロジェクトの AI 分析モード。API キー未設定の場合は AI 設定シートが開きます。
- フェーズはドラッグで並び替え可能です。進行状況やメンバー数は自動で更新されます。

### プロジェクト招待を作る
- プロジェクト詳細右上 `ギア` → 設定フォーム内の `招待` セクションで権限（閲覧 / 編集）を選び `招待コードを作成` を押します。
- 表示されるコードはタップでコピー、共有ボタンで各メッセージアプリへ送信できます。
- 受け取った側は `プロジェクト` タブの `プロジェクトに参加` からコードを入力して参加します。

## 5. タスクを進める
### フェーズとセクション
- プロジェクト詳細のフェーズをタップするとフェーズ内のセクション／タスク一覧に遷移します。
- `フォルダ +` アイコンでセクションを追加、セクション見出しのドラッグ操作で順序を変更できます。

### タスクを追加する
- フェーズ画面右上 `＋` でタスク追加シートが開きます。タイトルを入力し、必要に応じてセクションを選びます。`taskAddModalEnabled` が有効なビルドでは、`追加` ボタンを押すと TaskAddModal が開き、`手動で入力 / AI アシスタント / 写真から提案 / テンプレートを使う` を選択できます（フラグが無効な項目は「近日公開」と表示されます）。
- 追加したタスクはタップまたはチェックマークで完了・未完了を切り替えられます。右スワイプで編集・画像添付のショートカットが出ます。

### AI アシスタントを使う
- 事前準備: `設定 > AI設定` で OpenAI / Claude / Gemini のいずれかの API キーを登録し、優先プロバイダを選択します。
- タスク追加モーダルで `AI アシスタント` を選ぶと、生成モード（サブタスク / 改善 / 関連 / カスタム / 写真）を切り替えられます。
- 生成結果はプレビュー経由で確認し、`プレビューで確認` を選ぶと Tasks Preview 画面から受け入れ／破棄が行えます。プレビュー機能が無効な場合は直接タスクとして追加されます。
- エラーが出た場合はトーストに表示されたメッセージ（API キー未設定、レート制限、JSON 解析失敗など）をメモしてください。

### 写真からの提案
- タスク追加シートや AI アシスタントで `写真` モードを選択すると、カメラ撮影またはフォトライブラリ選択後にタスク候補が生成されます。
- `offlineBadgesEnabled` フラグが有効なビルドでは、タスク一覧に同期バッジ（例: "同期中"）が表示され、FireStore 同期が完了すると自動で消えます。
- AI プロバイダが利用できない場合は簡易テンプレートを提示する fallback が実行されます。

### テンプレートライブラリ
- タスク追加モーダルで `テンプレートを使う` を選ぶとテンプレートカタログから複数タスクを一括選択できます。
- 有料テンプレート／課金フローはベータでは無効化されており、すべて無料で利用できます。

### タスクの更新と添付
- タスクセルをタップすると完了状態が切り替わります。ロングタップ／スワイプメニューから編集ダイアログ、画像添付、再オープンが可能です。
- 添付のサムネイルをタップするとズームビューで確認できます。写真は JPEG Base64 形式で Firestore に保存されるため、大量添付は避けてください。

## 6. 設定とアカウント
- `設定` タブ上部のプロフィールカードからユーザー名を編集できます。メール表記は Sign in with Apple の設定に依存します。
- `AI機能 > AI設定` で API キーの登録／削除、既定プロバイダの選択ができます。
- `外観 > テーマ` でライト／ダーク／システムを切り替えられます。
- `サインアウト` ボタンは Firebase 認証を解除します。再ログイン時は再び Sign in with Apple を実行してください。

## 7. トラブルシュート
- **サインインできない**: Apple ID の 2 段階認証やスクリーンタイム制限を確認してください。解決しない場合はデモサインインで一時的に検証し、後で本アカウントに切り替えます。
- **招待コードが無効と出る**: コードの桁数・有効期限を確認し、再度コピー & ペーストで入力してください。`INV-` プレフィックス付きでもそのままで問題ありません。
- **AI が利用できない**: `設定 > AI設定` で API キーが保存されているか確認し、レート制限メッセージが出ている場合は provider を切り替えるか時間を空けて再試行してください。
- **プレビューが開かない**: `FeatureFlags.unifiedPreviewEnabled` が無効なビルドでは直接保存になります。テスト観点としては「プレビューが表示されない」こともメモしてください。
- **写真添付でクラッシュする**: 画像の解像度を下げて再試行し、操作手順と端末ストレージ残量を報告してください。

## 8. 既知の制限
- 写真ベースの提案は一部フローで「近日公開」表示になります（Phase タスクのクイック追加など）。
- KPI ダッシュボード、オフラインバッジ、課金系フラグはデフォルトで無効化されています。
- 課金（プロサブスクリプション／テンプレ IAP）は TestFlight では動作しません。該当画面が表示された場合は操作せずスクリーンショットを取得してください。
- タスク改善提案（設定内）はフラグオフのためアクセス不可です。

## 9. フィードバックの送り方
- TestFlight の `Send Beta Feedback` からスクリーンショット／画面収録にコメントを添えて送付してください。
- 報告には以下を含めると助かります。
  - 発生時刻（JST）
  - 使用していたタブと操作手順
  - 表示されたエラーメッセージ全文
  - 利用中のアカウント（ユーザー名または Apple ID のマスク表記）
- TestFlight 経由で送れない場合は従来のサポートチャンネルまたは開発チーム宛に同様の情報を共有してください。

## 10. 検証チェックリスト（推奨）
- [ ] 初回サインイン（Apple / デモ）でホーム画面が表示される
- [ ] 新規チーム作成 → 招待コード共有 → 別アカウントで加入
- [ ] プロジェクト作成（個人オーナー / チームオーナー両方）
- [ ] フェーズ追加・並べ替え・削除
- [ ] タスク追加（手動・AI・テンプレ・写真）とプレビュー受け入れ
- [ ] タスクの完了／未完了切り替え・編集・画像添付
- [ ] プロジェクト招待コードの発行と参加
- [ ] 設定タブでユーザー名変更・テーマ切替・AI キー登録
- [ ] サインアウト → 再ログインでデータが復元される

## 11. 追加連絡
- 仕様やテスト観点で不明点がある場合は、開発チームまで TestFlight フィードバックもしくは既存の連絡チャネルでお問い合わせください。
- ドキュメントに追記すべき点があれば `docs/testflight-beta-manual.md` を更新し、変更内容を共有してください。
